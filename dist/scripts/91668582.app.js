"use strict";angular.module("provaClientApp",["ngResource"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/edit/:templateEdit",{templateUrl:"views/edit.html",controller:"EditCtrl"}).when("/data/:templateId",{templateUrl:"views/data.html",controller:"DataCtrl"}).when("/form/:templateEdit",{templateUrl:"views/form.html",controller:"FormCtrl"}).when("/new",{templateUrl:"views/edit.html",controller:"NewCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("provaClientApp").factory("templateService",["$resource",function(a){return a("/coletor/templates/:templateId",{},{update:{method:"PUT"}})}]),angular.module("provaClientApp").factory("dataFormService",["$resource",function(a){return a("/coletor/templates/:templateId/data",{},{})}]),angular.module("provaClientApp").controller("RootCtrl",["$scope",function(a){a.messages=[],a.heightAlert=0,a.$on("alertEvent",function(c,d){c.preventDefault(),a.messages=d.errors,a.$watch("messages",function(){b(d.status)})}),a.upAlert=function(){$(".alert")[0].style.marginTop=-1*a.heightAlert+"px",setTimeout(function(){$(".alert")[0].classList.remove("showAlert")},500)};var b=function(b){var c=$(".alert")[0];a.heightAlert=c.offsetHeight,500===b&&c.classList.add("alert-error"),c.style.marginTop=-1*a.heightAlert+"px",setTimeout(function(){c.classList.add("showAlert"),c.style.visibility="visible",c.style.marginTop="20px"},1)}}]),angular.module("provaClientApp").controller("MainCtrl",["$scope","$http","templateService",function(a,b,c){a.formList=[],c.query(function(b){a.formList=b},function(b){a.$emit("alertEvent",b)}),a.removeForm=function(b){c.delete({templateId:b},function(){a.formList.splice(a.formList.indexOf({id:b}),1)},function(b){a.$emit("alertEvent",b)})}}]),angular.module("provaClientApp").controller("EditCtrl",["$scope","$location","$http","$routeParams","templateService",function(a,b,c,d,e){a.fieldList=[],a.fieldNew={},a.currentField={},a.form={},document.querySelectorAll(".btn-success")[0].style.display="none",e.get({templateId:d.templateEdit},function(b){a.form=b,a.fieldList=a.form.fields},function(b){a.$emit("alertEvent",b)});var f=function(){void 0!==a.form.title?e.update({templateId:d.templateEdit},a.form,function(){b.path("/")},function(b){a.$emit("alertEvent",b)}):(a.$emit("alertEvent",{errors:[{category:"O campo Título do Formulário é obrigatório"}]}),$(".edit input").first().focus())},g=function(a){var b=[],c=a.split(",");return c.forEach(function(a){var c=a.split(":");b.push({label:c[0],value:c[1]})}),b},h=function(a){var b="";return a.forEach(function(a){b+=a.label+":"+a.value+","}),b.substring(0,b.lastIndexOf(","))};a.changeRadio=function(a){a.radios=g(a.radiosView)};var i=function(b){this.field=b,this.messageErrors=[],this.sendErrors=function(){a.$emit("alertEvent",{errors:this.messageErrors})},this.addErrors=function(){var a=this.field,b=[],c=$(".pop");if(void 0===a.type||""===a.type?(b.push({message:"O campo TIPO é obrigatório"}),c.children("select").focus()):void 0===a.label?c.children("input[type=text]").eq(0).focus():void 0===a.radios&&$(c).children("div").children(".fieldRadios").focus(),(void 0===a.label||""===a.label)&&b.push({message:"O campo LABEL é obrigatório"}),"radio"===a.type)if(void 0===a.radios||""===a.radios)b.push({message:"O campo RADIOS é obrigatório"});else if(a.radios.length>0){var d=a.radiosView,e=d.match(/\w\:\w/g),f=d.split(",");null===e?b.push({message:"O campo RADIOS esta incorreto! Insira conforme o exemplo: Masculino:M, Feminino:F"}):e.length!==f.length&&b.push({message:"O campo RADIOS esta incorreto! Insira conforme o exemplo: Masculino:M, Feminino:F"})}this.messageErrors=b},this.hasErrors=function(){return 0===this.messageErrors.length?!1:!0},this.addErrors()};a.addField=function(){var b=new i(a.fieldNew);if(b.hasErrors())return b.sendErrors(),!1;if("radio"===a.fieldNew.type){var c=g(a.fieldNew.radiosView);a.fieldNew.radios=c}void 0===a.currentField.label?a.fieldList.push(a.fieldNew):$.extend(a.currentField,a.fieldNew),a.fieldNew={},a.currentField={},$("#addField").modal("hide")},a.toggleRequired=function(a,b){$(b.currentTarget).siblings(".active").removeClass("active"),a.required=a.required===!0?!1:!0,a.readOnly=!1},a.toggleReadonly=function(a,b){$(b.currentTarget).siblings(".active").removeClass("active"),a.readOnly=a.readOnly===!0?!1:!0,a.required=!1},a.editField=function(b){a.currentField=b;var c=$.extend({},b);c.radios&&(c.radiosView=h(c.radios)),a.fieldNew=$.extend({},c)},a.removeField=function(b){function c(a){return a.label!==b.label}a.fieldList=a.fieldList.filter(c)},a.createForm=f}]),angular.module("provaClientApp").controller("DataCtrl",["$scope","$routeParams","dataFormService",function(a,b,c){a.dataForm={},c.get({templateId:b.templateId},function(b){a.dataForm=b},function(b){a.$emit("alertEvent",b)})}]),angular.module("provaClientApp").controller("FormCtrl",["$scope","$location","$routeParams","templateService","dataFormService",function(a,b,c,d,e){a.data={},a.viewForm={},d.get({templateId:c.templateEdit},function(b){a.viewForm=b},function(b){a.$emit("alertEvent",b)}),a.cadastrar=function(){var d={};a.viewForm.fields.forEach(function(a){d[a.label]=a.value}),e.save({templateId:c.templateEdit},d,function(){b.path("/data/"+c.templateEdit)},function(b){a.$emit("alertEvent",b.data)})}}]),angular.module("provaClientApp").controller("NewCtrl",["$scope","$location","templateService",function(a,b,c){a.fieldList=[],a.fieldNew={},a.currentField={},a.form={fields:a.fieldList},document.querySelectorAll(".btn-success")[0].style.display="none",a.createForm=function(){void 0!==a.form.title?c.save(a.form,function(){b.path("/")},function(b){a.$emit("alertEvent",b)}):0===a.form.fields.length?(a.$emit("alertEvent",{errors:[{message:"Deve conter ao menos um campo!"}]}),document.querySelectorAll(".popForm")[0].focus()):(a.$emit("alertEvent",{errors:[{message:"Preencher o campo Título do Formulário"}]}),document.querySelectorAll(".edit input")[0].focus())};var d=function(a){var b=[],c=a.split(",");return c.forEach(function(a){var c=a.split(":");b.push({label:c[0],value:c[1]})}),b},e=function(a){var b="";return a.forEach(function(a){b+=a.label+":"+a.value+","}),b.substring(0,b.lastIndexOf(","))};a.changeRadio=function(a){a.radios=d(a.radiosView)};var f=function(b){this.field=b,this.messageErrors=[],this.sendErrors=function(){a.$emit("alertEvent",{errors:this.messageErrors})},this.addErrors=function(){var a=this.field,b=[],c=$(".pop");if(void 0===a.type||""===a.type?(b.push({message:"O campo TIPO é obrigatório"}),c.children("select").focus()):void 0===a.label?c.children("input[type=text]").eq(0).focus():void 0===a.radios&&$(c).children("div").children(".fieldRadios").focus(),(void 0===a.label||""===a.label)&&b.push({message:"O campo LABEL é obrigatório"}),"radio"===a.type)if(void 0===a.radios||""===a.radios)b.push({message:"O campo RADIOS é obrigatório"});else if(a.radios.length>0){var d=a.radiosView,e=d.match(/\w\:\w/g),f=d.split(",");null===e?b.push({message:"O campo RADIOS esta incorreto! Insira conforme o exemplo: Masculino:M, Feminino:F"}):e.length!==f.length&&b.push({message:"O campo RADIOS esta incorreto! Insira conforme o exemplo: Masculino:M, Feminino:F"})}this.messageErrors=b},this.hasErrors=function(){return 0===this.messageErrors.length?!1:!0},this.addErrors()};a.addField=function(){var b=new f(a.fieldNew);if(b.hasErrors())return b.sendErrors(),!1;if("radio"===a.fieldNew.type){var c=d(a.fieldNew.radiosView);a.fieldNew.radios=c}void 0===a.currentField.label?a.fieldList.push(a.fieldNew):$.extend(a.currentField,a.fieldNew),a.fieldNew={},a.currentField={},$("#addField").modal("hide")},a.toggleRequired=function(a,b){$(b.currentTarget).siblings(".active").removeClass("active"),a.required=a.required===!0?!1:!0,a.readOnly=!1},a.toggleReadonly=function(a,b){$(b.currentTarget).siblings(".active").removeClass("active"),a.readOnly=a.readOnly===!0?!1:!0,a.required=!1},a.editField=function(b){a.currentField=b;var c=$.extend({},b);c.radios&&(c.radiosView=e(c.radios)),a.fieldNew=$.extend({},c)},a.removeField=function(b){a.fieldList.splice(a.fieldList.indexOf(b),1)}}]);